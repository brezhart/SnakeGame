//arrsa = JSON.parse('[[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":4,"n":4}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":4,"n":5}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":3,"n":6}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":2,"n":7}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":1,"n":8}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":0,"n":10}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":1,"s":0,"w":0,"n":8}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":2,"s":0,"w":0,"n":7}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":3,"s":0,"w":0,"n":6}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":4,"s":0,"w":0,"n":5}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":4,"s":0,"w":0,"n":4}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":5,"n":4}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":4,"n":4}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":3,"n":6}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":2,"n":8}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":2,"n":12}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":0,"n":15}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":2,"s":0,"w":0,"n":12}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":2,"s":0,"w":0,"n":8}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":3,"s":0,"w":0,"n":6}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":4,"s":0,"w":0,"n":4}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":5,"s":0,"w":0,"n":4}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":6,"n":3}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":6,"n":3}},{"walls":{"e":1,"s":1,"w":-1,"n":-1},"food":{"e":0,"s":0,"w":10,"n":10}},{"walls":{"e":1,"s":0,"w":-1,"n":-1},"food":{"e":0,"s":0,"w":10,"n":10}},{"walls":{"e":1,"s":0,"w":-1,"n":-1},"food":{"e":0,"s":0,"w":8,"n":12}},{"walls":{"e":1,"s":0,"w":1,"n":-2},"food":{"e":0,"s":0,"w":0,"n":20}},{"walls":{"e":-1,"s":0,"w":1,"n":-1},"food":{"e":8,"s":0,"w":0,"n":12}},{"walls":{"e":-1,"s":0,"w":1,"n":-1},"food":{"e":10,"s":0,"w":0,"n":10}},{"walls":{"e":-1,"s":1,"w":1,"n":-1},"food":{"e":10,"s":0,"w":0,"n":10}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":6,"s":0,"w":0,"n":3}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":6,"s":0,"w":0,"n":3}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":7,"n":2}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":8,"n":2}},{"walls":{"e":0,"s":1,"w":-1,"n":-1},"food":{"e":0,"s":0,"w":10,"n":10}},{"walls":{"e":0,"s":0,"w":-2,"n":-2},"food":{"e":0,"s":0,"w":10,"n":10}},{"walls":{"e":1,"s":1,"w":-3,"n":-3},"food":{"e":0,"s":0,"w":12,"n":13}},{"walls":{"e":2,"s":2,"w":2,"n":-7},"food":{"e":0,"s":0,"w":0,"n":25}},{"walls":{"e":-3,"s":1,"w":1,"n":-3},"food":{"e":12,"s":0,"w":0,"n":13}},{"walls":{"e":-2,"s":0,"w":0,"n":-2},"food":{"e":10,"s":0,"w":0,"n":10}},{"walls":{"e":-1,"s":1,"w":0,"n":-1},"food":{"e":10,"s":0,"w":0,"n":10}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":8,"s":0,"w":0,"n":2}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":7,"s":0,"w":0,"n":2}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":8,"n":1}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":12,"n":2}},{"walls":{"e":0,"s":1,"w":-1,"n":-1},"food":{"e":0,"s":0,"w":12,"n":8}},{"walls":{"e":1,"s":1,"w":-3,"n":-3},"food":{"e":0,"s":0,"w":13,"n":12}},{"walls":{"e":5,"s":5,"w":-5,"n":-5},"food":{"e":0,"s":0,"w":15,"n":15}},{"walls":{"e":10,"s":10,"w":10,"n":-99},"food":{"e":0,"s":0,"w":0,"n":35}},{"walls":{"e":-5,"s":5,"w":5,"n":-5},"food":{"e":15,"s":0,"w":0,"n":15}},{"walls":{"e":-3,"s":1,"w":1,"n":-3},"food":{"e":13,"s":0,"w":0,"n":12}},{"walls":{"e":-1,"s":1,"w":0,"n":-1},"food":{"e":12,"s":0,"w":0,"n":8}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":12,"s":0,"w":0,"n":2}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":8,"s":0,"w":0,"n":1}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":10,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":15,"n":0}},{"walls":{"e":0,"s":1,"w":-2,"n":1},"food":{"e":0,"s":0,"w":20,"n":0}},{"walls":{"e":2,"s":2,"w":-7,"n":2},"food":{"e":0,"s":0,"w":25,"n":0}},{"walls":{"e":10,"s":10,"w":-99,"n":10},"food":{"e":0,"s":0,"w":35,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":0,"w":0,"n":0}},{"walls":{"e":-99,"s":10,"w":10,"n":10},"food":{"e":35,"s":0,"w":0,"n":0}},{"walls":{"e":-7,"s":2,"w":2,"n":2},"food":{"e":25,"s":0,"w":0,"n":0}},{"walls":{"e":-2,"s":1,"w":0,"n":1},"food":{"e":20,"s":0,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":15,"s":0,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":10,"s":0,"w":0,"n":0}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":1,"w":8,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":2,"w":12,"n":0}},{"walls":{"e":0,"s":-1,"w":-1,"n":1},"food":{"e":0,"s":8,"w":12,"n":0}},{"walls":{"e":1,"s":-3,"w":-3,"n":1},"food":{"e":0,"s":12,"w":13,"n":0}},{"walls":{"e":5,"s":-5,"w":-5,"n":5},"food":{"e":0,"s":15,"w":15,"n":0}},{"walls":{"e":10,"s":-99,"w":10,"n":10},"food":{"e":0,"s":35,"w":0,"n":0}},{"walls":{"e":-5,"s":-5,"w":5,"n":5},"food":{"e":15,"s":15,"w":0,"n":0}},{"walls":{"e":-3,"s":-3,"w":1,"n":1},"food":{"e":13,"s":12,"w":0,"n":0}},{"walls":{"e":-1,"s":-1,"w":0,"n":1},"food":{"e":12,"s":8,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":12,"s":2,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":8,"s":1,"w":0,"n":0}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":2,"w":7,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":2,"w":8,"n":0}},{"walls":{"e":0,"s":-1,"w":-1,"n":1},"food":{"e":0,"s":10,"w":10,"n":0}},{"walls":{"e":0,"s":-2,"w":-2,"n":0},"food":{"e":0,"s":10,"w":10,"n":0}},{"walls":{"e":1,"s":-3,"w":-3,"n":1},"food":{"e":0,"s":13,"w":12,"n":0}},{"walls":{"e":2,"s":-7,"w":2,"n":2},"food":{"e":0,"s":25,"w":0,"n":0}},{"walls":{"e":1,"s":-3,"w":-3,"n":1},"food":{"e":12,"s":13,"w":0,"n":0}},{"walls":{"e":-2,"s":-2,"w":0,"n":0},"food":{"e":10,"s":10,"w":0,"n":0}},{"walls":{"e":-1,"s":-1,"w":0,"n":1},"food":{"e":10,"s":10,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":8,"s":2,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":7,"s":2,"w":0,"n":0}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":3,"w":6,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":3,"w":6,"n":0}},{"walls":{"e":1,"s":-1,"w":-1,"n":1},"food":{"e":0,"s":10,"w":10,"n":0}},{"walls":{"e":1,"s":-1,"w":-1,"n":0},"food":{"e":0,"s":10,"w":10,"n":0}},{"walls":{"e":1,"s":-1,"w":-1,"n":0},"food":{"e":0,"s":12,"w":8,"n":0}},{"walls":{"e":1,"s":-2,"w":1,"n":0},"food":{"e":0,"s":20,"w":0,"n":0}},{"walls":{"e":-1,"s":-1,"w":1,"n":0},"food":{"e":8,"s":12,"w":0,"n":0}},{"walls":{"e":-1,"s":-1,"w":1,"n":0},"food":{"e":10,"s":10,"w":0,"n":0}},{"walls":{"e":-1,"s":-1,"w":1,"n":1},"food":{"e":10,"s":10,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":6,"s":3,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":6,"s":3,"w":0,"n":0}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":4,"w":5,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":4,"w":4,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":6,"w":3,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":8,"w":2,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":12,"w":2,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":15,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":2,"s":12,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":2,"s":8,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":3,"s":6,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":4,"s":4,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":5,"s":4,"w":0,"n":0}}],[{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":4,"w":4,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":5,"w":4,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":6,"w":3,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":7,"w":2,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":8,"w":1,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":0,"s":10,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":1,"s":8,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":2,"s":7,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":3,"s":5,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":4,"s":6,"w":0,"n":0}},{"walls":{"e":0,"s":0,"w":0,"n":0},"food":{"e":4,"s":4,"w":0,"n":0}}]]')
console.log("LENGTH",arrsa.length);




class Snake{
    constructor(w,h,arrInp,field,color) {
        this.view = {w:w,h:h};
        this.poss = arrInp;
        this.dead = false;
        this.color = color;
        for (let i = 0; i <  this.poss.length; i++){
            field.area[this.poss[i].y][this.poss[i].x] = "W"
        }

        this.pos = this.poss[0];
        this.view.area = arrsa;
    }
    wSum(field){ // return sum of all weights (food and walls)
        let dirObj = {e:0,s:0,w:0,n:0}; // returning object that have sum of detects cell
        for (let i = 0; i < this.view.h; i++){
            for (let g = 0; g < this.view.w; g++){
                let posNX = this.pos.x - (this.view.w - 1)/2 + g;
                let posNY = this.pos.y - (this.view.h - 1)/2 + i;
                if ((posNX >=0 && posNX < field.w) && (posNY >=0 && posNY < field.h)) {
                    if (field.area[posNY][posNX] == "F") {
                        dirObj.e += this.view.area[i][g].food.e;
                        dirObj.s += this.view.area[i][g].food.s;
                        dirObj.w += this.view.area[i][g].food.w;
                        dirObj.n += this.view.area[i][g].food.n;
                    } else if (field.area[posNY][posNX] == "W") {
                        dirObj.e += this.view.area[i][g].walls.e;
                        dirObj.s += this.view.area[i][g].walls.s;
                        dirObj.w += this.view.area[i][g].walls.w;
                        dirObj.n += this.view.area[i][g].walls.n;
                    }
                }
            }
        }
        return [dirObj.e,dirObj.s,dirObj.w,dirObj.n]
    }
    makeStep(field) {
        if (!this.dead) {
            field.area[this.poss[0].y][this.poss[0].x] = "W";

            let dirObj = this.wSum(field);
            let possibleWays = getAllIndexes(dirObj, Math.max(...dirObj));
            possibleWays = possibleWays[gRI(0, possibleWays.length - 1)];

            let newHead = {x: this.pos.x, y: this.pos.y};
            switch (possibleWays) {
                case 0:
                    newHead.x += 1;
                    break;
                case 1:
                    newHead.y += 1;
                    break;
                case 2:
                    newHead.x -= 1;
                    break;
                case 3:
                    newHead.y -= 1;
            }
            this.poss.unshift(newHead);
            this.pos = this.poss[0];
            if (field.area[this.pos.y][this.pos.x] == "F") {
                let f = new Food(field);
                field.area[this.poss[0].y][this.poss[0].x] = "W"

            } else if (field.area[this.pos.y][this.pos.x] == "W") {
                this.dead = true
                field.area[this.poss[0].y][this.poss[0].x] = "W";
                field.area[this.poss[this.poss.length - 1].y][this.poss[this.poss.length - 1].x] = "A";
                this.poss.splice(this.poss.length - 1);
            } else {
                field.area[this.poss[0].y][this.poss[0].x] = "W";
                field.area[this.poss[this.poss.length - 1].y][this.poss[this.poss.length - 1].x] = "A";
                this.poss.splice(this.poss.length - 1);


            }


        }
    }


    draw(ctx,w,h,field){
        for (let i = 0; i < this.poss.length; i++) {
            ctx.beginPath();
            ctx.fillStyle = this.dead ? "gray" : (i == 0 ? LightenColor(this.color,-70) : this.color);
            let s = Math.min(w, h);
            ctx.fillRect(this.poss[i].x * (s / field.w), this.poss[i].y * (s / field.h), s / field.w, s / field.h);
            ctx.closePath();
        }
    }
}

//snake = new Snake(7,7);
